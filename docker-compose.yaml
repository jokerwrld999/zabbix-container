version: "3"
services:
   mysql-server:
      image: mysql:8.0
      container_name: mysql-server
      restart: unless-stopped
      environment:
         - MYSQL_DATABASE="zabbix"
         - MYSQL_USER="zabbix"
         - MYSQL_PASSWORD="zabbix_pwd"
         - MYSQL_ROOT_PASSWORD="root_pwd"
      command:
         - mysqld
         - --character-set-server=utf8mb
         - --collation-server=utf8_bin']
         - --default-authentication-plugin=mysql_native_password
      volumes:
         - ./zbx_env/var/lib/mysql:/var/lib/mysql:rw
   zabbix-java-gateway:
      image: zabbix/zabbix-java-gateway:alpine-6.2-latest
      container_name: zabbix-java-gateway
      restart: unless-stopped
   zabbix-server-mysql:
      image: zabbix/zabbix-server-mysql:alpine-6.2-latest
      container_name: zabbix-server-mysql
      restart: unless-stopped
      environment:
         - DB_SERVER_HOST="mysql-server"
         - MYSQL_DATABASE="zabbix"
         - MYSQL_USER="zabbix"
         - MYSQL_PASSWORD="zabbix_pwd"
         - MYSQL_ROOT_PASSWORD="root_pwd"
         - ZBX_JAVAGATEWAY="zabbix-java-gateway"
      ports:
         - 10051:1051
      volumes:
         - /etc/localtime:/etc/localtime:ro
         - ./zbx_env/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts:ro
         - ./zbx_env/usr/lib/zabbix/externalscripts:/usr/lib/zabbix/externalscripts:ro
         - ./zbx_env/var/lib/zabbix/dbscripts:/var/lib/zabbix/dbscripts:ro
         - ./zbx_env/var/lib/zabbix/export:/var/lib/zabbix/export:rw
         - ./zbx_env/var/lib/zabbix/modules:/var/lib/zabbix/modules:ro
         - ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc:ro
         - ./zbx_env/var/lib/zabbix/ssh_keys:/var/lib/zabbix/ssh_keys:ro
         - ./zbx_env/var/lib/zabbix/mibs:/var/lib/zabbix/mibs:ro
         - snmptraps:/var/lib/zabbix/snmptraps:rw
      depends_on:
         - mysql-server
         - zabbix-build-mysql
   zabbix-web-nginx-mysql:
      image: zabbix/zabbix-web-nginx-mysql:alpine-6.2-latest
      container_name: zabbix-web-nginx-mysql
      restart: unless-stopped
      ports:
         - 80:8080
         - 443:8443
      environment:
         - ZBX_SERVER_HOST="zabbix-server-mysql"
         - DB_SERVER_HOST="mysql-server"
         - MYSQL_DATABASE="zabbix"
         - MYSQL_USER="zabbix"
         - MYSQL_PASSWORD="zabbix_pwd"
         - MYSQL_ROOT_PASSWORD="root_pwd"
      volumes:
         - /etc/localtime:/etc/localtime:ro
         - ./zbx_env/etc/ssl/nginx:/etc/ssl/nginx:ro
         - ./zbx_env/usr/share/zabbix/modules/:/usr/share/zabbix/modules/:ro
